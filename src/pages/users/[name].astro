---
import Layout from "../../layouts/Layout.astro";
import ProfileBanner from "../../components/ProfileBanner.astro";
import PhotoLists from "../../components/PhotoLists.astro";
import Button from "../../components/Button.astro";
import type { ImageDatas, User, Urls } from "../../interfaces/interfaces";

export async function getStaticPaths() {
  const API_KEY = import.meta.env.TOP_SECRET;
  let imageDatas = [] as ImageDatas[];

  let response = await fetch(
    `https://api.unsplash.com/photos/?client_id=${API_KEY}`
  );
  let datas = await response.json();

  return datas.map(({ user, urls }: { user: User; urls: Urls }) => {
    return {
      params: { name: `${user.username}` },
      props: {
        url: `${urls.small}`,
        username: `${user.username}`,
        profile_image: `${user.profile_image.large}`,
        portfolio_url: `${user.social.portfolio_url}`,
        instagram: `${user.social.instagram_username}`,
        twitter: `${user.social.twitter_username}`,
        bio: `${user.bio}`,
        location: `${user.location}`,
      },
    };
  });
}

const API_KEY = import.meta.env.TOP_SECRET;
const { name } = Astro.params;
const {
  username,
  profile_image,
  instagram,
  twitter,
  bio,
  portfolio_url,
  location,
} = Astro.props;

let user_photos = [] as ImageDatas[];

let user_res = await fetch(
  `https://api.unsplash.com/users/${username}/photos/?client_id=${API_KEY}`
);

let res_user_data = await user_res.json();
user_photos = res_user_data;
---

<Layout title={name}>
  <div class="py-8 flex flex-col justify-center w-full space-y-8">
    <ProfileBanner
      name={name}
      username={username}
      profile_image={profile_image}
      instagram_username={instagram}
      twitter_username={twitter}
      bio={bio}
      portfolio_url={portfolio_url}
      location={location}
    />

    <Button title={"Hello"} />
    <section
      class="columns-1 md:columns-2 lg:columns-3 break-before-avoid space-y-4 inline-block text-zinc-100"
    >
      {user_photos?.map((photo) => <PhotoLists photo={photo} />)}
    </section>
  </div>
</Layout>
